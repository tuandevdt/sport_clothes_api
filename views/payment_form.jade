extends layout

block content
    h3=title
    div.table-responsive
        form#paymentForm(action='create_vnpay_payment_url', method='POST')
            div.form-group
                label Số tiền (VNĐ)
                input.form-control#amount(name='amount', type='number', placeholder='Nhập số tiền', value=amount, required)

            div.form-group
                label Chọn Phương thức thanh toán:
                div.controls
                    label.radio-inline
                        #[input(type="radio", name="bankCode", value="", checked="true")] Cổng thanh toán VNPAYQR
                    div.controls
                    label.radio-inline
                        #[input(type="radio", name="bankCode", value="VNPAYQR")] Thanh toán qua ứng dụng hỗ trợ VNPAYQR
                    div.controls
                    label.radio-inline
                        #[input(type="radio", name="bankCode", value="VNBANK")] Thanh toán qua ATM-Tài khoản ngân hàng nội địa
                    div.controls
                    label.radio-inline
                        #[input(type="radio", name="bankCode", value="INTCARD")] Thanh toán qua thẻ quốc tế

            div.form-group
                label Thông tin thẻ (nếu có):
                input.form-control#cardNumber(name='cardNumber', type='text', placeholder='Số thẻ (tùy chọn)')
                input.form-control#cardHolder(name='cardHolder', type='text', placeholder='Tên chủ thẻ (tùy chọn)', style='margin-top: 5px;')
                div.row(style='margin-top: 5px;')
                    div.col-md-6
                        input.form-control#expiryDate(name='expiryDate', type='text', placeholder='MM/YY (tùy chọn)')
                    div.col-md-6
                        input.form-control#cvv(name='cvv', type='text', placeholder='CVV (tùy chọn)')

            div.form-group
                label Thông tin giao dịch:
                input.form-control#orderInfo(name='orderInfo', type='text', placeholder='Mô tả giao dịch', value='Thanh toan don hang')

            div.form-group
                label Ngôn ngữ
                div.controls
                    label.radio-inline
                        #[input(type="radio", name="language", value="vn", checked="true")] Tiếng việt
                    div.controls
                    label.radio-inline
                        #[input(type="radio", name="language", value="en")] Tiếng anh

            button.btn.btn-primary#btnSubmit(type='submit') Thanh toán ngay
            button.btn.btn-secondary#btnReset(type='reset', style='margin-left: 10px;') Làm mới

    div.alert.alert-info(style='margin-top: 20px;')
        h4 Hướng dẫn test:
        ul
            li Nhập số tiền cần thanh toán
            li Chọn phương thức thanh toán phù hợp
            li Thông tin thẻ là tùy chọn (có thể để trống)
            li Click "Thanh toán ngay" để chuyển đến VNPAY
        p
            strong Lưu ý: 
            | Đây là môi trường sandbox, bạn có thể test với thông tin giả.

    script.
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                amount: parseInt(formData.get('amount')),
                bankCode: formData.get('bankCode'),
                cardNumber: formData.get('cardNumber'),
                cardHolder: formData.get('cardHolder'),
                expiryDate: formData.get('expiryDate'),
                cvv: formData.get('cvv'),
                orderInfo: formData.get('orderInfo'),
                language: formData.get('language')
            };
            
            // Gửi request đến API
            fetch('/order/create_vnpay_payment_url', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (data) {
                    alert('Có lỗi xảy ra: ' + data);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra khi xử lý thanh toán');
            });
        }); 